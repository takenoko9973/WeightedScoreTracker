# Weighted Score Tracker

回数ごとの重み付け（指数加重移動平均）を用いてスコアを管理・グラフ化するローカル用ツール。

## 概要

* **計算ロジック**: 最新のスコアを重み `1.0` とし、過去に遡るごとに指定した減衰率（デフォルト `0.95`）を掛けた重みで平均を算出。
* **グラフ**: Matplotlibを使用。バーの「横幅」が重みを表し、面積で貢献度を可視化。
* **保存**: `scores_data.json` に自動保存（JSON形式）。

## 動作環境

* Python 3.9+
* 依存ライブラリ:
  * `PySide6`
  * `matplotlib`

## セットアップと起動

1. **ライブラリのインストール**

   ```bash
   uv sync
   ```

2. **起動**
    `main.py` があるディレクトリで以下を実行。

    ```bash
    python main.py
    ```

## ファイル構成と役割（メンテナンス用）

リファクタリング後の構成と、各モジュールの担当領域は以下の通り。

### ルートディレクトリ

* **`main.py`**
  * **役割**: アプリケーションのエントリーポイント。
  * **内容**: アプリの初期化、`MainWindow` の表示のみを行う。
* **`scores_data.json`**
  * **役割**: データ保存用ファイル。
  * **内容**: 自動生成される。手動編集時はJSONフォーマット破損に注意。

### `score_app/` パッケージ

MVC構成に基づき分割されている。

* **`config.py`**

  * **役割**: 定数・設定管理。
  * **内容**: グラフの色 (`COLOR_...`)、フォント設定 (`FONT_LIST`)、ウィンドウサイズ、デフォルト減衰率など。デザイン変更時はここを修正する。

* **`data_model.py`**

  * **役割**: Model（データ永続化・管理）。
  * **内容**:
    * JSONファイルの読み書き。
    * `dataclass` (`CategoryData`) によるデータ構造の定義。
    * `logging` モジュールによるログ出力設定。

* **`calculator.py`**

  * **役割**: Logic（計算ロジック）。
  * **内容**: スコアリストと減衰率を受け取り、「加重平均」と「重み配列」を返す純粋関数。GUIや保存処理には依存しない。

* **`components.py`**

  * **役割**: View（UI部品）。
  * **内容**: メイン画面を構成する個別のウィジェット群。
    * `CategoryWidget`: 左側の項目リスト。
    * `ControlHeaderWidget`: 右上の情報表示・設定ボタン。
    * `InputWidget`: スコア入力欄。
    * `HistoryWidget`: 履歴リスト。
  * **注意**: ここにはロジックを書かず、操作されたら `Signal` を発行するのみにする。

* **`plot_widget.py`**

  * **役割**: View（グラフ描画）。
  * **内容**: Matplotlib の `FigureCanvas` を継承したウィジェット。データを受け取って棒グラフを描画する処理のみ記述。

* **`main_window.py`**

  * **役割**: Controller（統括）。
  * **内容**:
    * アプリ全体のレイアウト構築（各コンポーネントの配置）。
    * イベント処理（ボタン押下時の挙動、エラーダイアログの表示）。
    * Model(`DataManager`) と View(`components`, `plot_widget`) の橋渡し。

## 備考

* 入力は整数値のみ対応。マイナス値は入力不可（`main_window.py` でチェック）。
* 項目ごとに減衰率（重み）を `0.01` \~ `1.00` の範囲で設定可能。
