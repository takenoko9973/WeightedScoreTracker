# Weighted Score Tracker

日々のスコアを記録し、減衰率（Decay Rate）を用いた時系列加重平均を算出・可視化するRust製GUIソフトウェア。

## 概要

単純な算術平均ではなく、最新のデータに高い重みを、過去のデータに低い重みを割り当てるアルゴリズムを採用しています。これにより、過去の記録の影響を徐々に減衰させ、現在のパフォーマンス傾向を定量的に評価します。

## 主な機能

  * **データ管理**:
      * カテゴリと項目の2階層構造によるデータ整理。
      * データの永続化（`scores_data.json` への自動保存）。
      * 更新日時（`updated_at`）に基づく自動ソート機能。
  * **計算ロジック**:
      * 項目ごとに設定可能な減衰率（0.01 - 1.00）。
      * スコアの登録順序に基づく重み付け計算。
  * **可視化 (GUI)**:
      * `egui` フレームワークによるデスクトップUI。
      * 棒グラフ描画：各スコアの「重み」を棒の横幅（太さ）として表現。
      * 加重平均値のガイドライン表示。
  * **編集機能**:
      * カテゴリ/項目の追加・削除。
      * コンテキストメニュー（右クリック）による一括編集（名称変更、カテゴリ移動、減衰率変更）。

## アルゴリズム仕様

加重平均（Weighted Average）は以下のロジックで算出されます。

**定義:**

  * $N$: スコアの総数
  * $S_i$: $i$番目のスコア（$0 \le i < N$, $i=N-1$ が最新）
  * $r$: 減衰率（Decay Rate, $0 < r \le 1$）

**重み ($w_i$) の計算:**
最新のスコアを基準（$1.0$）とし、過去に遡るごとに $r$ を乗算します。
$$w_i = r^{(N-1)-i}$$

**加重平均 ($Avg$) の計算:**
$$Avg = \frac{\sum_{i=0}^{N-1} (S_i \times w_i)}{\sum_{i=0}^{N-1} w_i}$$

## ディレクトリ構成

リファクタリング後のソースコード構成は以下の通りです。

```text
src/
├── main.rs                 # エントリーポイント / ウィンドウ設定
├── app.rs                  # アプリケーションの状態制御 / イベントハンドリング
├── logic.rs                # 計算ロジック (統計・プロット用計算)
├── models.rs               # データ構造定義 / バリデーション / 更新ロジック
├── persistence.rs          # JSONファイルの保存・読み込み処理
└── ui/
    ├── mod.rs
    ├── state.rs            # UI状態定義 (UiState, ModalType, SelectionState)
    ├── fonts.rs            # フォント読み込み設定
    ├── central_panel.rs    # メインパネルのレイアウト定義
    ├── side_panel.rs       # サイドパネルのレイアウト定義
    ├── components/         # 再利用可能なUIコンポーネント
    │   ├── category_list.rs  # カテゴリツリー描画
    │   ├── history_list.rs   # 履歴リスト描画
    │   ├── score_chart.rs    # グラフ描画
    │   └── score_input.rs    # 入力フォーム描画
    └── modals/             # モーダルウィンドウ定義
        ├── mod.rs            # ディスパッチャー
        ├── category.rs       # カテゴリ追加・編集
        ├── item.rs           # 項目追加・編集
        ├── confirm.rs        # 削除確認
        └── error.rs          # エラー表示
```

## ライセンス

[MIT License](https://www.google.com/search?q=LICENSE)

---

(超適当生成AI産)
